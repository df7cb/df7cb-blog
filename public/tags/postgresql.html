<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Myon&#39;s Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.152.2">
    
    
    
      <meta name="robots" content="index, follow">
    
    <meta name="author" content="Christoph Berg">
    

    
<link rel="stylesheet" href="/blog/ananke/css/main.min.efe4d852f731d5d1fbb87718387202a97aafd768cdcdaed0662bbe6982e91824.css" >




    


    
      

    

    
    
      <link href="/blog/tags/postgresql/index.xml" rel="alternate" type="application/rss+xml" title="Myon&#39;s Blog" />
      <link href="/blog/tags/postgresql/index.xml" rel="feed" type="application/rss+xml" title="Myon&#39;s Blog" />
      
    

    
      <link rel="canonical" href="https://df7cb.de/blog/tags/postgresql.html">
    

    <meta property="og:url" content="https://df7cb.de/blog/tags/postgresql.html">
  <meta property="og:site_name" content="Myon&#39;s Blog">
  <meta property="og:title" content="Postgresql">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Postgresql">
  <meta itemprop="datePublished" content="2023-08-26T23:49:40+02:00">
  <meta itemprop="dateModified" content="2023-08-26T23:49:40+02:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Postgresql">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/blog/index.html" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Myon&#39;s Blog
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Postgresql
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links mid-gray">
      <p>Below you will find pages that utilize the taxonomy term “Postgresql”</p>
    </div>
  </article>
  <div class="mw8 center">
    <section class="flex-ns mt5 flex-wrap justify-around">
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2023/popcon-postgresql.html" class="link black dim">
        PostgreSQL Popularity Contest
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Back in 2015, when PostgreSQL 9.5 alpha 1 was released, I had posted the
<a href="https://www.df7cb.de/blog/2015/PostgreSQL_9.5_in_Debian.html">PostgreSQL data from Debian&rsquo;s popularity contest</a>.</p>
<p>8 years and 8 PostgreSQL releases later, the graph now looks like this:</p>
<p><a href="https://qa.debian.org/popcon-graph.php?packages=postgresql+postgresql-7.4+postgresql-8.0+postgresql-8.1+postgresql-8.2+postgresql-8.3+postgresql-8.4+postgresql-9.0+postgresql-9.1+postgresql-9.2+postgresql-9.3+postgresql-9.4+postgresql-9.5+postgresql-9.6+postgresql-10+postgresql-11+postgresql-12+postgresql-13+postgresql-14+postgresql-15+postgresql-16&show_installed=on&want_legend=on&want_ticks=on&from_date=&to_date=&hlght_date=&date_fmt=%25Y-%25m&beenhere=1"><img src="https://www.df7cb.de/blog/2023/popcon-postgresql.png"></a></p>
<p>Currently, the most popular PostgreSQL on Debian systems is still PostgreSQL 13 (shipped in Bullseye), followed by PostgreSQL 11 (Buster). At the time of writing,
PostgreSQL 9.6 (Stretch) and PostgreSQL 15 (Bookworm) share the third place, with 15 rising quickly.</p>
    </div>
    <a href="/blog/posts/2023/popcon-postgresql.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2021/postgresql-undelete.html" class="link black dim">
        PostgreSQL and Undelete
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="pg_dirtyread">pg_dirtyread</h2>
<p>Earlier this week, I updated <a href="https://github.com/df7cb/pg_dirtyread">pg_dirtyread</a>
to work with <a href="https://www.postgresql.org/docs/14/index.html">PostgreSQL 14</a>.
pg_dirtyread is a PostgreSQL extension that allows reading &ldquo;dead&rdquo; rows from
tables, i.e. rows that have already been deleted, or updated. Of course that
works only if the table has not been cleaned-up yet by a VACUUM command or
autovacuum, which is PostgreSQL&rsquo;s garbage collection machinery.</p>
<p>Here&rsquo;s an example of pg_dirtyread in action:</p>
<pre tabindex="0"><code># create table foo (id int, t text);
CREATE TABLE
# insert into foo values (1, &#39;Doc1&#39;);
INSERT 0 1
# insert into foo values (2, &#39;Doc2&#39;);
INSERT 0 1
# insert into foo values (3, &#39;Doc3&#39;);
INSERT 0 1

# select * from foo;
 id │  t
────┼──────
  1 │ Doc1
  2 │ Doc2
  3 │ Doc3
(3 rows)

# delete from foo where id &lt; 3;
DELETE 2

# select * from foo;
 id │  t
────┼──────
  3 │ Doc3
(1 row)
</code></pre><p>Oops! The first two documents have disappeared.</p>
<p>Now let&rsquo;s use pg_dirtyread to look at the table:</p>
<pre tabindex="0"><code># create extension pg_dirtyread;
CREATE EXTENSION

# select * from pg_dirtyread(&#39;foo&#39;) t(id int, t text);
 id │  t
────┼──────
  1 │ Doc1
  2 │ Doc2
  3 │ Doc3
</code></pre><p>All three documents are still there, but only one of them is visible.</p>
<p>pg_dirtyread can also show PostgreSQL&rsquo;s system colums with the row location and
visibility information. For the first two documents, xmax is set, which means
the row has been deleted:</p>
<pre tabindex="0"><code># select * from pg_dirtyread(&#39;foo&#39;) t(ctid tid, xmin xid, xmax xid, id int, t text);
 ctid  │ xmin │ xmax │ id │  t
───────┼──────┼──────┼────┼──────
 (0,1) │ 1577 │ 1580 │  1 │ Doc1
 (0,2) │ 1578 │ 1580 │  2 │ Doc2
 (0,3) │ 1579 │    0 │  3 │ Doc3
(3 rows)
</code></pre><h2 id="undelete">Undelete</h2>
<p><strong>Caveat:</strong> <em>I&rsquo;m not promising any of the ideas quoted below will actually work in
practice. There are a few caveats and a good portion of intricate knowledge
about the PostgreSQL internals might be required to succeed properly. Consider
consulting your favorite PostgreSQL support channel for advice if you need to
recover data on any production system.</em> <strong>Don&rsquo;t try this at work.</strong></p>
<p>I always had plans to extend pg_dirtyread to include some &ldquo;undelete&rdquo; command to
make deleted rows reappear, but never got around to trying that. But rows can already be
restored by using the output of pg_dirtyread itself:</p>
<pre tabindex="0"><code># insert into foo select * from pg_dirtyread(&#39;foo&#39;) t(id int, t text) where id = 1;
</code></pre><p>This is not a true &ldquo;undelete&rdquo;, though - it just inserts new rows from the data
read from the table.</p>
<h2 id="pg_surgery">pg_surgery</h2>
<p>Enter <a href="https://www.postgresql.org/docs/current/pgsurgery.html">pg_surgery</a>,
which is a new PostgreSQL extension supplied with PostgreSQL 14. It contains
two functions to &ldquo;perform surgery on a damaged relation&rdquo;. As a side-effect,
they can also make delete tuples reappear.</p>
<p>As I discovered now, one of the functions, heap_force_freeze(), works nicely
with pg_dirtyread. It takes a list of ctids (row locations) that it marks
&ldquo;frozen&rdquo;, but at the same time as &ldquo;not deleted&rdquo;.</p>
<p>Let&rsquo;s apply it to our test table, using the ctids that pg_dirtyread can read:</p>
<pre tabindex="0"><code># create extension pg_surgery;
CREATE EXTENSION

# select heap_force_freeze(&#39;foo&#39;, array_agg(ctid))
    from pg_dirtyread(&#39;foo&#39;) t(ctid tid, xmin xid, xmax xid, id int, t text) where id = 1;
 heap_force_freeze
───────────────────

(1 row)
</code></pre><p>Et voilà, our deleted document is back:</p>
    </div>
    <a href="/blog/posts/2021/postgresql-undelete.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2020/arm64-on-apt.postgresql.org.html" class="link black dim">
        arm64 on apt.postgresql.org
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The <a href="https://apt.postgresql.org/">apt.postgresql.org</a> repository has been extended
to cover the <em>arm64</em> architecture.</p>
<p>We had occasionally received user request to add &ldquo;arm&rdquo; in the past, but it was
never really clear which kind of &ldquo;arm&rdquo; made sense to target for PostgreSQL. In
terms of Debian architectures, there&rsquo;s (at least) armel, armhf, and arm64.
Furthermore, Raspberry Pis are very popular (and indeed what most users seemed
to were asking about), but the raspbian &ldquo;armhf&rdquo; port is incompatible with the
Debian &ldquo;armhf&rdquo; port.</p>
<p>Now that most hardware has moved to 64-bit, it was becoming clear that &ldquo;arm64&rdquo;
was the way to go. Amit Khandekar made it happen that
<a href="https://intl.huaweicloud.com/en-us/">HUAWEI Cloud Services</a>
donated a arm64 build host with enough resources to build the arm64 packages
at the same speed as the existing amd64, i386, and ppc64el architectures.
A few days later, all the build jobs were done, including passing all
test-suites. Very few arm-specific issues were encountered which makes me
confident that arm64 is a solid architecture to run PostgreSQL on.</p>
<p>We are targeting Debian buster (stable), bullseye (testing), and sid
(unstable), and Ubuntu bionic (18.04) and focal (20.04). To use the arm64
archive, just add the normal sources.list entry:</p>
<pre>
deb https://apt.postgresql.org/pub/repos/apt buster-pgdg main
</pre>
<h2>Ubuntu focal</h2>
<p>At the same time, I&rsquo;ve added the next Ubuntu LTS release to apt.postgresql.org:
focal (20.04). It ships amd64, arm64, and ppc64el binaries.</p>
<pre>
deb https://apt.postgresql.org/pub/repos/apt focal-pgdg main
</pre>
<h2>Old PostgreSQL versions</h2>
<p>Many PostgreSQL extensions are still supporting older server versions that are
EOL. For testing these extension, server packages need to be available. I&rsquo;ve
built packages for PostgreSQL 9.2+ on all Debian distributions, and all Ubuntu
LTS distributions. 9.1 will follow shortly.</p>
<p>This means people can move to newer base distributions in their .travis.yml,
.gitlab-ci.yml, and other CI files.</p>
    </div>
    <a href="/blog/posts/2020/arm64-on-apt.postgresql.org.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2020/apt-archive.postgresql.org.html" class="link black dim">
        Announcing apt-archive.postgresql.org
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Users had often asked where they could find older versions of packages from
<a href="https://apt.postgresql.org/">apt.postgresql.org</a>. I had been
collecting these since about April 2013, and in July 2016, I made the packages
available via an ad-hoc URL on the repository master host, called &ldquo;the morgue&rdquo;.
There was little repository structure, all files belonging to a source package
were stuffed into a single directory, no matter what distribution they belonged
to. Besides this not being particularly accessible for users, the main problem
was the ever-increasing need for more disk space on the repository host. We are
now at 175 GB for the archive, of which 152 GB is for the morgue.</p>
<p>Our friends from <a href="https://yum.postgresql.org/">yum.postgresql.org</a>
have had a proper archive host (yum-archive.postgresql.org) for some time
already, so it was about time to follow suit and implement a proper archive
for apt.postgresql.org as well, usable from apt.</p>
<p>So here it is:
<b><a href="https://apt-archive.postgresql.org/">apt-archive.postgresql.org</a></b></p>
<p>The archive covers all past and current Debian and Ubuntu distributions. The
apt sources.lists entries are similar to the main repository, just with &ldquo;-archive&rdquo;
appended to the host name and the
<a href="https://apt-archive.postgresql.org/pub/repos/apt/dists/index.html">distribution</a>:</p>
<pre>
deb https://apt-archive.postgresql.org/pub/repos/apt DIST-pgdg-archive main
deb-src https://apt-archive.postgresql.org/pub/repos/apt DIST-pgdg-archive main
</pre>
<p>The oldest PostgreSQL server versions covered there are 8.2.23, 8.3.23, 8.4.17,
9.0.13, 9.1.9, 9.2.4, 9.3beta1, and everything newer.</p>
<p>Some example:</p>
<pre>
$ apt-cache policy postgresql-12
postgresql-12:
  Installed: 12.2-2.pgdg+1+b1
  Candidate: 12.2-2.pgdg+1+b1
  Version table:
 *** 12.2-2.pgdg+1+b1 900
        500 http://apt.postgresql.org/pub/repos/apt sid-pgdg/main amd64 Packages
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
        100 /var/lib/dpkg/status
     12.2-2.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12.2-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12.1-2.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12.1-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12.0-2.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12.0-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12~rc1-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12~beta4-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12~beta3-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12~beta2-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
     12~beta1-1.pgdg+1 500
        500 https://apt-archive.postgresql.org/pub/repos/apt sid-pgdg-archive/main amd64 Packages
</pre>
<p>Because this is hosted on S3, browsing directories is only supported indirectly by
static index.html files, so if you want to look at some specific URL, append
&ldquo;/index.html&rdquo; to see it.</p>
<p>The archive is powered by a
<a href="https://git.postgresql.org/gitweb/?p=pgapt.git;a=tree;f=pgapt-db/sql">PostgreSQL database</a> and a
<a href="https://git.postgresql.org/gitweb/?p=pgapt.git;a=tree;f=repo/bin">bunch of python/shell scripts</a>,
from which the apt index files are built.</p>
<h2>Archiving old distributions</h2>
<p>I&rsquo;m also using the opportunity to remove some long-retired distributions from the main
repository host. The following distributions have been moved over:</p>
<ul>
<li>Debian etch (4.0)</li>
<li>Debian lenny (5.0)</li>
<li>Debian squeeze (6.0)</li>
<li>Ubuntu lucid (10.04)</li>
<li>Ubuntu saucy (13.10)</li>
<li>Ubuntu utopic (14.10)</li>
<li>Ubuntu wily (15.10)</li>
<li>Ubuntu zesty (17.04)</li>
<li>Ubuntu cosmic (18.10)</li>
</ul>
<p>They are available as &ldquo;<em>DIST</em>-pgdg&rdquo; from the archive, e.g. squeeze:</p>
<pre>
deb https://apt-archive.postgresql.org/pub/repos/apt squeeze-pgdg main
deb-src https://apt-archive.postgresql.org/pub/repos/apt squeeze-pgdg main
</pre>
    </div>
    <a href="/blog/posts/2020/apt-archive.postgresql.org.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2015/10_Years_Debian_Developer.html" class="link black dim">
        10 Years Debian Developer
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I knew it was about this time of the year 10 years ago when my Debian account
was created, but I couldn&rsquo;t remember the exact date until I looked it up
earlier this evening: today :). Rene Engelhard had been my advocate, and Marc
Brockschmidt my AM. Thanks guys!</p>
<p>A lot of time has passed since then, and I&rsquo;ve worked in various parts of the
project. I became an application manager almost immediately, and quickly got
into the NM front desk as well, revamping parts of the NM process which had
become pretty bureaucratic (I think we are now, 10 years later, back where we
should be, thanks to almost all of the paperwork being automated, thanks
Enrico!). I&rsquo;ve processed 37 NMs, most of them between 2005 and 2008, later I
was only active as front desk and eventually Debian account manager. I&rsquo;ve
recently picked up AMing again, which I still find quite refreshing as the AM
will always also learn new things.</p>
<p>Quality Assurance was and is the other big field. Starting by doing QA uploads
of orphaned packages, I attended some QA meetings around Germany, and picked up
maintenance of the DDPO pages, which I still maintain. The link between QA and
NM is the MIA team where I was active for some years until they kindly kicked
me out because I was MIA there myself. I&rsquo;m glad they are still using some of
the scripts I was writing to automate some things.</p>
<p>My favorite MUA is mutt, of which I became co-maintainer in 2007, and later
maintainer. I&rsquo;m still listed in the uploaders field, but admittedly I haven&rsquo;t
really done anything there lately.</p>
<p>Also in 2007 I started working at credativ, after having been a research
assistant at the university, which meant making my Debian work professional. Of
course it also meant more real work and less time for the hobby part, but I was
still very active around that time. Later in 2010 I was marrying, and we got
two kids, at which point family was of course much more important, so my Debian
involvement dropped to a minimum. (Mostly lurking on IRC ;)</p>
<p>Being a PostgreSQL consultant at work, it was natural to start looking into the
packaging, so I started submitting patches to postgresql-common in 2011, and
became a co-maintainer in 2012. Since then, I&rsquo;ve mostly been working on
PostgreSQL-related packages, of which far too many have my (co-)maintainer
stamp on them. To link the Debian and PostgreSQL worlds together, we started an
external repository (apt.postgresql.org) that contains packages for the
PostgreSQL major releases that Debian doesn&rsquo;t ship. Most of my open source time
at the moment is spent on getting all PostgreSQL packages in shape for Debian
and this repository.</p>
<p>According to minechangelogs, currently 844 changelog entries in Debian mention
my name, or were authored by me. Scrolling back yields memories of packages
that are long gone again from unstable, or I passed on to other maintainers.
There are way too many people in Debian that I enjoy(ed) working with to list
them here, and many of them are my friends. Debian is really the extended
family on the internet. My last DebConf before this year had been in Mar del
Plata - I had met some people at other conferences like FOSDEM, but meeting
(almost) everyone again in Heidelberg was very nice. I even remembered all
basic Mao rules :D.</p>
    </div>
    <a href="/blog/posts/2015/10_Years_Debian_Developer.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2015/PostgreSQL_9.5_in_Debian.html" class="link black dim">
        PostgreSQL 9.5 in Debian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Today saw the release of PostgreSQL 9.5 Alpha 1. Packages for all supported
Debian and Ubuntu releases are available on <a href="http://apt.postgresql.org/">apt.postgresql.org</a>:</p>
<tt>
deb http://apt.postgresql.org/pub/repos/apt/ <i>YOUR_RELEASE_HERE</i>-pgdg main 9.5
</tt>
<p>The package is also waiting in NEW to be accepted for Debian experimental.</p>
<p>Being curious which PostgreSQL releases have been in use over time, I pulled some graphics
from <a href="https://qa.debian.org/popcon-graph.php?packages=postgresql+postgresql-7.4+postgresql-8.0+postgresql-8.1+postgresql-8.2+postgresql-8.3+postgresql-8.4+postgresql-9.0+postgresql-9.1+postgresql-9.2+postgresql-9.3+postgresql-9.4+postgresql-9.5&show_installed=on&want_legend=on&want_ticks=on&from_date=&to_date=&hlght_date=&date_fmt=%25Y-%25m&beenhere=1">Debian&rsquo;s popularity contest data</a>:</p>
<p><a href="https://qa.debian.org/popcon-graph.php?packages=postgresql+postgresql-7.4+postgresql-8.0+postgresql-8.1+postgresql-8.2+postgresql-8.3+postgresql-8.4+postgresql-9.0+postgresql-9.1+postgresql-9.2+postgresql-9.3+postgresql-9.4+postgresql-9.5&show_installed=on&want_legend=on&want_ticks=on&from_date=&to_date=&hlght_date=&date_fmt=%25Y-%25m&beenhere=1"><img src="https://www.df7cb.de/blog/2015/popcon-postgresql.png"></a></p>
<p>Before we included the PostgreSQL major version in the package name,
&ldquo;postgresql&rdquo; contained the server, so that line represents the installation
count of the pre-7.4 releases at the left end of the graph.</p>
<p>Interestingly, 7.4 reached its installation peak well past 8.1&rsquo;s. Does anyone have an
idea why that happened?</p>
    </div>
    <a href="/blog/posts/2015/PostgreSQL_9.5_in_Debian.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2015/apt.postgresql.org_statistics.html" class="link black dim">
        apt.postgresql.org statistics
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>At this year&rsquo;s FOSDEM I gave a talk in the PostgreSQL devroom
about <a href="http://www.df7cb.de/projects/talks/2015-FOSDEM/">
Large Scale Quality Assurance in the PostgreSQL Ecosystem</a>.
The talk included a graph about the growth of the
<a href="https://apt.postgresql.org/">apt.postgresql.org</a>
repository that I want to share here as well:</p>
<img src="https://www.df7cb.de/blog/2015/apt-stats.png">
<p>The yellow line at the very bottom is the number of different source package
names, currently 71. From that, a somewhat larger number of actual source
packages that include the &ldquo;pgdgXX&rdquo; version suffixes targeting the various
distributions we have is built (blue). The number of different binary package
names (green) is in about the same range. The dimension explosion then happens
for the actual number of binary packages (black, almost 8000) targeting all
distributions and architectures.</p>
<p>The red line is the total size of the pool/ directory, currently a bit less
than 6GB.</p>
<p>(The graphs sometimes decrease when packages in the -testing distributions are
promoted to the live distributions and the old live packages get removed.)</p>
    </div>
    <a href="/blog/posts/2015/apt.postgresql.org_statistics.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2014/PostgreSQL_9.4_on_Debian.html" class="link black dim">
        PostgreSQL 9.4 on Debian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Yesterday saw the first beta release of the new PostgreSQL version 9.4. Along
with the sources, we uploaded binary packages to Debian experimental and
apt.postgresql.org, so there&rsquo;s now packages ready to be tested on Debian
wheezy, squeeze, testing/unstable, and Ubuntu trusty, saucy, precise, and
lucid.</p>
<p>If you are using one of the release distributions of Debian or Ubuntu, add this
to your /etc/apt/sources.list.d/pgdg.list to have 9.4 available:</p>
<p>deb <a href="http://apt.postgresql.org/pub/repos/apt/">http://apt.postgresql.org/pub/repos/apt/</a> codename-pgdg main 9.4</p>
<p>On Debian jessie and sid, install the packages from experimental.</p>
<p>Happy testing!</p>
    </div>
    <a href="/blog/posts/2014/PostgreSQL_9.4_on_Debian.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2014/Trusty_and_Saucy_on_apt.postgresql.org.html" class="link black dim">
        Trusty and Saucy on apt.postgresql.org
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Over the past few weeks, new distributions have been added on
<a href="http://apt.postgresql.org/">apt.postgresql.org</a>:
Ubuntu 13.10 codenamed &ldquo;saucy&rdquo; and the upcoming Ubuntu LTS release 14.04
codenamed &ldquo;trusty&rdquo;.</p>
<p>Adding non-LTS releases for the benefit of developers using PostgreSQL on their
notebooks and desktop machines has been a frequently requested item since we
created the repository. I had some qualms about targeting a new Ubuntu release
every 6 months, but with having automated more and more parts of the repository
infrastructure, and the bootstrapping process now being painless, the
distributions are now available for use. Technically, trusty started as empty,
so it hasn&rsquo;t all packages yet, but of course all the PostgreSQL server packages
are there, along with pgAdmin. Saucy started as a copy of precise (12.04) so it
has all packages. Not all packages have been rebuilt for saucy, but the precise
packages included (you can tell by the version number ending in .pgdg12.4+12 or
.pgdg13.10+1) will work, unless apt complains about dependency problems. I have
rebuilt the packages needing it I was aware about (most notably the
postgresql-plperl packages) - if you spot problems, please let us know on the
mailing list.</p>
<p>Needless to say, last week&rsquo;s PostgreSQL server updates are already included in
the repository.</p>
    </div>
    <a href="/blog/posts/2014/Trusty_and_Saucy_on_apt.postgresql.org.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2013/How_not_to_monitor_a_boolean.html" class="link black dim">
        How not to monitor a boolean
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>We were lazy and wrote a simple PostgreSQL monitoring check in shell instead of
using some proper language. The code looked about this:</p>
<pre>
out=$(psql -tAc "SELECT some_stuff, t > now() - '1 day'::interval FROM some_table" some_db 2>&1)
case $out in
	*t) echo "OK: $out" ;;
	*) echo "NOT OK: $out" ;;
esac
</pre>
<p>If the string ends with &rsquo;t&rsquo;, all is well, if it ends with &lsquo;f&rsquo; or someting else, something is wrong.</p>
<p>Unfortunately, this didn&rsquo;t go that well:</p>
<p><tt>OK: psql: FATAL:  database &ldquo;some_db&rdquo; does not exis<em>t</em></tt></p>
    </div>
    <a href="/blog/posts/2013/How_not_to_monitor_a_boolean.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2013/PostgreSQL_minor_releases.html" class="link black dim">
        PostgreSQL minor releases
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>We&rsquo;ve just put the new PostgreSQL minor releases live on apt.postgresql.org.
Building 5 major versions for 10 distributions produces quite a lot of stuff:</p>
<ul>
<li>25 .dsc files (source packages)
<li>745 .deb files (360 *_amd64.deb + 360 *_i386.deb + 25 *_all.deb)
<li>497 MB in *_amd64.deb files
<li>488 MB in *_i386.deb files
<li>58 MB in *_all.deb files
<li>73 MB in *.orig.tar.bz2 files
<li>in total 1118 MB
</ul>
<p>Compiling took a bit more than 10 hours on a 2-cpu VM. Of course that includes
running regression tests and the postgresql-common testsuite.</p>
<p><b>Note:</b> This will be the last update published on pgapt.debian.net. Please
update your sources.list entries to point to apt.postgresql.org!</p>
    </div>
    <a href="/blog/posts/2013/PostgreSQL_minor_releases.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2012/apt.postgresql.org.html" class="link black dim">
        apt.postgresql.org
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>So we finally made it, and sent out an
<a href="http://archives.postgresql.org/pgsql-announce/2012-12/msg00008.php">official announcement</a> for
<a href="https://wiki.postgresql.org/wiki/Apt">apt.postgresql.org</a>.</p>
<p>This new repository hosts packages for all PostgreSQL server versions (at the
moment 8.3, 8.4, 9.0, 9.1, 9.2) for several Debian/Ubuntu distributions
(squeeze, wheezy, sid, precise) on two architectures (amd64, i386). Now add
packages for extension modules on top of all these, and you get a really large
amount of binaries from a small number of sources. Right now there&rsquo;s 1670 .deb
files and 148 .dsc files, but the .dsc count includes variants that only differ
in the version number per distribution (we attach .pgdg60+1 for squeeze
packages, .pgdg70+1 for wheezy and so on), so the real number of different
sources is rather something like 81, with 38 distinct source package names.</p>
<p><a href="http://tapoueh.org/">Dimitri Fontaine</a>,
<a href="http://www.hagander.net/">Magnus Hagander</a>, and I have been working
on this since I first presented the idea at PGconf.EU 2011 in Amsterdam. We now
have a Jenkins server building all the packages, an archive server with the
master repository, and a feed that syncs the repository to the postgresql.org
FTP (well, mostly http) server.</p>
<p>If you were previously using pgapt.debian.net, that&rsquo;s the same archive as on
apt.postgresql.org (one rsync away). Please update your sources.list to point
to apt.postgresql.org, I&rsquo;ll shut down the archive at that location at the end
of January.</p>
<p>Here&rsquo;s the <a href="https://wiki.postgresql.org/wiki/Apt#Quickstart">Quickstart
instructions from the Wiki page</a>:</p>
<p>Import the repository key from <a href="http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc">http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc</a>:</p>
<pre>
wget -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | sudo apt-key add -
</pre>
<p>Edit /etc/apt/sources.list.d/pgdg.list. The distributions are called codename-pgdg. In the example, replace squeeze with the actual distribution you are using:</p>
<pre>
deb http://apt.postgresql.org/pub/repos/apt/ squeeze-pgdg main
</pre>
<p>Configure apt&rsquo;s package pinning to prefer the PGDG packages over the Debian ones in /etc/apt/preferences.d/pgdg.pref:</p>
<pre>
Package: *
Pin: release o=apt.postgresql.org
Pin-Priority: 500
</pre>
<p>Note: this will replace all your Debian/Ubuntu packages with available packages from the PGDG repository. If you do not want this, skip this step.</p>
<p>Update the package lists, and install the pgdg-keyring package to automatically get repository key updates:</p>
<pre>
apt-get update
apt-get install pgdg-keyring
</pre>
    </div>
    <a href="/blog/posts/2012/apt.postgresql.org.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2012/pgbouncer_running_on_the_same_hardware.html" class="link black dim">
        pgbouncer running on the same hardware
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>We have a PostgreSQL server with 16 cores that was apparently running well
below its capacity: load something between 3.0 and 4.0, around 200 active
database connections, almost all always being &lt;IDLE&gt;. However, when the
tps count reached 7k transactions per second, things started to throttle, and
pgbouncer (running on the database server) started listing up to half of the
client connections to be in cl_waiting state. Load was still low, but
application performance was bad.</p>
<img src="http://www.df7cb.de/blog/2012/renice_pgbouncer.png">
<p>The culprit turned out to be the kernel scheduler, fairly distributing CPU time
among all running processes. There&rsquo;s one single pgbouncer process, but hundreds
of postgres processes.</p>
<p>A simple <em>renice</em> of the pgbouncer process did the trick and gave us another
extra 2k tps.</p>
    </div>
    <a href="/blog/posts/2012/pgbouncer_running_on_the_same_hardware.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2012/Shared_Memory_and_Swapping.html" class="link black dim">
        Shared Memory and Swapping
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>We have this PostgreSQL server with plenty of RAM that is still using some of
its swap over the day (up to 600MB). Then suddenly everything is swapped in
again.</p>
<img src="http://www.df7cb.de/blog/2012/dbsrv_swap.png">
<p>It turned out the reason is there are two clusters running, and the second one
isn&rsquo;t used as heavily as the first one. Disk I/O activity of the first cluster
slowly evicts pages from the second shared buffers cache to swap, and then the
daily pg_dump run reads them back every evening.</p>
<p>I was not aware of an easy way to get numbers for &ldquo;amount of SysV shared memory
swapped to disk&rdquo;, but some googling led to shmctl(2):</p>
<pre>
#define _GNU_SOURCE 1
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main ()
{
        struct shm_info info;
        int max;
        long PAGE_SIZE = sysconf(_SC_PAGESIZE);

        max = shmctl(0, SHM_INFO, (struct shmid_ds *) &info);
        printf ("max: %d\nshm_tot: %ld\nshm_rss: %ld\nshm_swp: %ld\n",
                        max,
                        info.shm_tot * PAGE_SIZE,
                        info.shm_rss * PAGE_SIZE,
                        info.shm_swp * PAGE_SIZE);

        return 0;
}
</pre>
<p>The output looks like this:</p>
<pre>
max: 13
shm_tot: 13232308224
shm_rss: 12626661376
shm_swp: 601616384
</pre>
<p><b>Update:</b> Mark points out that <em>ipcs -mu</em> shows the same information. Thanks for the hint!</p>
<pre>
# ipcs -mu

------ Shared Memory Status --------
segments allocated 2
pages allocated 3230544
pages resident  3177975
pages swapped   51585
Swap performance: 0 attempts     0 successes
</pre>
    </div>
    <a href="/blog/posts/2012/Shared_Memory_and_Swapping.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2012/PostgreSQL_in_Debian_Hackathon.html" class="link black dim">
        PostgreSQL in Debian Hackathon
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Almost a year has passed since my talk at pgconf.eu 2011 in Amsterdam on
<a href="http://www.postgresql.eu/events/schedule/pgconfeu2011/session/166-connecting-the-debian-and-postgresql-worlds/">Connecting the Debian and PostgreSQL worlds</a>,
and unfortunately little has happened on that front, mostly due to my limited
spare time between family and job.
<a href="http://pgapt.debian.net/">pgapt.debian.net</a> is up and running, but
got few updates and is lagging behind on PostgreSQL releases.</p>
<p>Luckily, we got the project moving. <a href="http://tapoueh.org/blog/index.html">Dimitri Fontaine</a>
and <a href="http://blog.hagander.net/">Magnus Hagander</a> suggested to do a
face-to-face meeting, so we got together at my house for two days last week and
discussed ideas, repository layouts, build scripts, and whatnot to get all of
us aligned for pushing the project ahead. My
<a href="http://www.credativ.de/">employer</a> sponsored my time off work for
that. We almost finished moving the repository to postgresql.org
infrastructure, barring some questions of how to hook the repository into the
existing mirror infrastructure; this should get resolved this week.</p>
<p>The build server running Jenkins is still located on my laptop, but moving this
to a proper host will also happen really soon now. We are using
<a href="http://michael-prokop.at/blog/">Mika Prokop</a>&rsquo;s
<a href="http://jenkins-debian-glue.org/">jenkins-debian-glue</a> scripts for
driving the package build from Jenkins. The big plus point about Jenkins is
that it makes executing jobs on different distributions and architectures in
parallel much easier than a bunch of homemade shell scripts could get us with
reasonable effort.</p>
<p>Here&rsquo;s a list of random points we discussed:</p>
<ul>
<li>We decided to go for &ldquo;pgdg&rdquo; in version numbers and distribution names, i.e.
packages will have version numbers like 9.1.5-1.pgdg+1, with distributions
wheezy-pgdg, squeeze-pgdg, and so on.</li>
<li>There will be Debian-testing-style distributions called like
wheezy-pgdg-testing that packages go into for some time before they get
promoted to the &ldquo;live&rdquo; distributions.</li>
<li>PostgreSQL versions out of support (8.2 and below) will not be removed from
the repository, but will be moved to distributions called like
wheezy-pgdg-deprecated. People will still be able to use them, but the
naming should make it clear that they should really be upgrading.</li>
<li>We have a slightly modified (compared to Debian unstable) postgresql-common
package that sets the &ldquo;supported-versions&rdquo; to all versions supported by the
PostgreSQL project. That will make the postgresql-server-dev-all package
pull in build-dependencies for all server versions, and make extension
module packages compile for all of them automatically. (Provided they are
using pg_buildext.)</li>
<li>There&rsquo;s no Ubuntu support in there yet, but that&rsquo;s mostly only a matter of
adding more cowbuilder chroots to the build jobs. TBD soon.</li>
</ul>
<p>We really aim at using unmodified packages from Debian as much as possible, and
in fact this project doesn&rsquo;t mean to replace Debian&rsquo;s PostgreSQL packaging
work, but to extend it beyond the number of server versions (and Debian and
Ubuntu versions covered) supported. The people behind the Debian and Ubuntu
packages, and this repository are mostly the same, so we will claim that &ldquo;our&rdquo;
packages will be the same quality as the &ldquo;original&rdquo; ones. Big thanks go to
<a href="http://www.piware.de/">Martin Pitt</a> for maintaining the
postgresql-common testsuite that really covers every aspect of running
PostgreSQL servers on Debian/Ubuntu systems.</p>
<p>Stay tuned for updates! :)</p>
    </div>
    <a href="/blog/posts/2012/PostgreSQL_in_Debian_Hackathon.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/blog/posts/2011/PostgreSQL_in_Debian.html" class="link black dim">
        PostgreSQL in Debian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>At work, I&rsquo;m dealing with lots of different database setups, luckily mostly
PostgreSQL running on Debian. At the same time, a fair amount of the tools in
the PostgreSQL ecosystem (not the PostgreSQL server packages itself) are not in
the best shape in the Debian archive.</p>
<p>I&rsquo;m trying to change that by adopting some of the packages. So far, I have
fixed a few RC bugs where packages where suddenly trying to build against
PostgreSQL 9.0 while expecting 8.4. To my surprise, there are no packages yet
in the archive that support multiple PostgreSQL versions in parallel. There is
even a package ready to help doing this -
<a href="http://packages.debian.org/sid/postgresql-server-dev-all">postgresql-server-dev-all</a>,
but apparently nobody has used it yet. It turned out that after working around
a few trivial problems and adding just a few lines of sh code, it was pretty
straightforward
to port <a href="http://packages.qa.debian.org/s/skytools.html">skytools</a> and
<a href="http://packages.qa.debian.org/p/postgresql-pllua.html">postgresql-pllua</a>
to 9.0 while keeping 8.4 support. The latter has no version-specific code left
in debian/ except for a list of supported versions in debian/pgversions, so a
future port to 9.1 will be trivial. (Fun fact: the old postgresql-pllua version
0.8.1 was actually a typoed 0.3.1 version.)</p>
<p>Most PostgreSQL tools use a common
<a href="http://svn.debian.org/wsvn/pkg-postgresql/trunk/">subversion repository on Alioth</a>,
but there is no common mailing list address that is put into the Uploaders
fields, so it is hard to get an overview over the state of all packages. I&rsquo;ve
compiled a list of all packages in svn, git, bzr (the server packages), and a
few others
<a href="http://qa.debian.org/developer.php?login=pkg-postgresql-public@lists.alioth.debian.org">in DDPO</a>
to fix that for now.</p>
<p>Other packages I&rsquo;ve updated so far are
<a href="http://packages.qa.debian.org/p/pgtune.html">pgtune</a>,
<a href="http://packages.qa.debian.org/p/pgbouncer.html">pgbouncer</a>, and
<a href="http://packages.qa.debian.org/p/pgpool2.html">pgpool2</a>.</p>
    </div>
    <a href="/blog/posts/2011/PostgreSQL_in_Debian.html" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
    </section>
  </div>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://df7cb.de/blog/index.html" >
    &copy;  Myon's Blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
