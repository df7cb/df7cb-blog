<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Too much magic in Gentoo | Myon&#39;s Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Five years after the release of patch 2.5.9, patch 2.6 was released two weeks
ago. The most interesting feature is that it will now produce reject files in
unified format when the input is in that format. Lucky for those of us whose
brain hurts when trying to read context diffs.
Of course there are more changes, and one of them is affecting Gentoo in particular:

Gentoo service announcement: keep clear of GNU patch-2.6. The linked
Gentoo bug #293570
has attachments to reproduce the bug:

benz:~/tmp/tripwire-2.3.1-2 $ patch -p0 -F3 &lt; ../tripwire-friend-classes.patch
patching file tripwire-2.3.1-2-p1/src/fco/fconame.h
Hunk #1 succeeded at 48 with fuzz 3 (offset -1 lines).
patching file tripwire-2.3.1-2-p1/src/fco/fcosetimpl.h
Hunk #1 succeeded at 45 with fuzz 3 (offset -1 lines).
patching file tripwire-2.3.1-2-p1/src/tw/fcoreport.h
Hunk #1 succeeded at 84 with fuzz 3 (offset -1 lines).

benz:~/tmp/tripwire-2.3.1-2 $ ls -l
drwxr-xr-x 4 cbe credativ 4096 18. Nov 05:03 src/
drwxr-xr-x 3 cbe credativ 4096  2. Dez 12:23 tripwire-2.3.1-2-p1/

Note that it created a new tripwire-2.3.1-2-p1 directory inside the existing
one, which is consistent with -p0. The newly created file contain just the &ldquo;&#43;&rdquo;
lines from the patch. (There are no &ldquo;-&rdquo; lines.) patch 2.5.9 would have refused
the patch because it couldn&rsquo;t find the file to patch.
This is arguably a surprising behavior, but what really happens here is that
-F3 (fuzz 3) will explicitly tell patch to ignore 3 context lines if it cannot
apply the patch otherwise. diff&rsquo;s default behavior is to create patches with 3
lines of context. patch&rsquo;s default fuzz factor is one less than that, 2. Now, 3

3 is zero, which doesn&rsquo;t leave any context left.

Apparently lots of Gentoo ebuilds use -F3, and try to guess the correct number
of directories to strip, starting with -p0, -p1, &hellip; No wonder that things
break badly for them now, as patches will suddenly succeed with -p0.
I&rsquo;m not sure I like the new patch behavior, but in Gentoo&rsquo;s case I&rsquo;d say they
are using way too much magic in their build system, and now get bitten by
options they shouldn&rsquo;t have put there in the first place.">
    <meta name="generator" content="Hugo 0.152.2">
    
    
    
      <meta name="robots" content="index, follow">
    
    <meta name="author" content="Christoph Berg">
    

    
<link rel="stylesheet" href="/blog/ananke/css/main.min.efe4d852f731d5d1fbb87718387202a97aafd768cdcdaed0662bbe6982e91824.css" >




    


    
      

    

    

    
      <link rel="canonical" href="https://df7cb.de/blog/posts/2009/Too_much_magic_in_Gentoo.html">
    

    <meta property="og:url" content="https://df7cb.de/blog/posts/2009/Too_much_magic_in_Gentoo.html">
  <meta property="og:site_name" content="Myon&#39;s Blog">
  <meta property="og:title" content="Too much magic in Gentoo">
  <meta property="og:description" content="Five years after the release of patch 2.5.9, patch 2.6 was released two weeks ago. The most interesting feature is that it will now produce reject files in unified format when the input is in that format. Lucky for those of us whose brain hurts when trying to read context diffs.
Of course there are more changes, and one of them is affecting Gentoo in particular: Gentoo service announcement: keep clear of GNU patch-2.6. The linked Gentoo bug #293570 has attachments to reproduce the bug:
benz:~/tmp/tripwire-2.3.1-2 $ patch -p0 -F3 &lt; ../tripwire-friend-classes.patch patching file tripwire-2.3.1-2-p1/src/fco/fconame.h Hunk #1 succeeded at 48 with fuzz 3 (offset -1 lines). patching file tripwire-2.3.1-2-p1/src/fco/fcosetimpl.h Hunk #1 succeeded at 45 with fuzz 3 (offset -1 lines). patching file tripwire-2.3.1-2-p1/src/tw/fcoreport.h Hunk #1 succeeded at 84 with fuzz 3 (offset -1 lines). benz:~/tmp/tripwire-2.3.1-2 $ ls -l drwxr-xr-x 4 cbe credativ 4096 18. Nov 05:03 src/ drwxr-xr-x 3 cbe credativ 4096 2. Dez 12:23 tripwire-2.3.1-2-p1/ Note that it created a new tripwire-2.3.1-2-p1 directory inside the existing one, which is consistent with -p0. The newly created file contain just the “&#43;” lines from the patch. (There are no “-” lines.) patch 2.5.9 would have refused the patch because it couldn’t find the file to patch.
This is arguably a surprising behavior, but what really happens here is that -F3 (fuzz 3) will explicitly tell patch to ignore 3 context lines if it cannot apply the patch otherwise. diff’s default behavior is to create patches with 3 lines of context. patch’s default fuzz factor is one less than that, 2. Now, 3
3 is zero, which doesn’t leave any context left. Apparently lots of Gentoo ebuilds use -F3, and try to guess the correct number of directories to strip, starting with -p0, -p1, … No wonder that things break badly for them now, as patches will suddenly succeed with -p0.
I’m not sure I like the new patch behavior, but in Gentoo’s case I’d say they are using way too much magic in their build system, and now get bitten by options they shouldn’t have put there in the first place.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2009-02-17T13:21:52+01:00">
    <meta property="article:modified_time" content="2009-02-17T13:21:52+01:00">
    <meta property="article:tag" content="Debian">

  <meta itemprop="name" content="Too much magic in Gentoo">
  <meta itemprop="description" content="Five years after the release of patch 2.5.9, patch 2.6 was released two weeks ago. The most interesting feature is that it will now produce reject files in unified format when the input is in that format. Lucky for those of us whose brain hurts when trying to read context diffs.
Of course there are more changes, and one of them is affecting Gentoo in particular: Gentoo service announcement: keep clear of GNU patch-2.6. The linked Gentoo bug #293570 has attachments to reproduce the bug:
benz:~/tmp/tripwire-2.3.1-2 $ patch -p0 -F3 &lt; ../tripwire-friend-classes.patch patching file tripwire-2.3.1-2-p1/src/fco/fconame.h Hunk #1 succeeded at 48 with fuzz 3 (offset -1 lines). patching file tripwire-2.3.1-2-p1/src/fco/fcosetimpl.h Hunk #1 succeeded at 45 with fuzz 3 (offset -1 lines). patching file tripwire-2.3.1-2-p1/src/tw/fcoreport.h Hunk #1 succeeded at 84 with fuzz 3 (offset -1 lines). benz:~/tmp/tripwire-2.3.1-2 $ ls -l drwxr-xr-x 4 cbe credativ 4096 18. Nov 05:03 src/ drwxr-xr-x 3 cbe credativ 4096 2. Dez 12:23 tripwire-2.3.1-2-p1/ Note that it created a new tripwire-2.3.1-2-p1 directory inside the existing one, which is consistent with -p0. The newly created file contain just the “&#43;” lines from the patch. (There are no “-” lines.) patch 2.5.9 would have refused the patch because it couldn’t find the file to patch.
This is arguably a surprising behavior, but what really happens here is that -F3 (fuzz 3) will explicitly tell patch to ignore 3 context lines if it cannot apply the patch otherwise. diff’s default behavior is to create patches with 3 lines of context. patch’s default fuzz factor is one less than that, 2. Now, 3
3 is zero, which doesn’t leave any context left. Apparently lots of Gentoo ebuilds use -F3, and try to guess the correct number of directories to strip, starting with -p0, -p1, … No wonder that things break badly for them now, as patches will suddenly succeed with -p0.
I’m not sure I like the new patch behavior, but in Gentoo’s case I’d say they are using way too much magic in their build system, and now get bitten by options they shouldn’t have put there in the first place.">
  <meta itemprop="datePublished" content="2009-02-17T13:21:52+01:00">
  <meta itemprop="dateModified" content="2009-02-17T13:21:52+01:00">
  <meta itemprop="wordCount" content="350">
  <meta itemprop="keywords" content="Debian">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Too much magic in Gentoo">
  <meta name="twitter:description" content="Five years after the release of patch 2.5.9, patch 2.6 was released two weeks ago. The most interesting feature is that it will now produce reject files in unified format when the input is in that format. Lucky for those of us whose brain hurts when trying to read context diffs.
Of course there are more changes, and one of them is affecting Gentoo in particular: Gentoo service announcement: keep clear of GNU patch-2.6. The linked Gentoo bug #293570 has attachments to reproduce the bug:
benz:~/tmp/tripwire-2.3.1-2 $ patch -p0 -F3 &lt; ../tripwire-friend-classes.patch patching file tripwire-2.3.1-2-p1/src/fco/fconame.h Hunk #1 succeeded at 48 with fuzz 3 (offset -1 lines). patching file tripwire-2.3.1-2-p1/src/fco/fcosetimpl.h Hunk #1 succeeded at 45 with fuzz 3 (offset -1 lines). patching file tripwire-2.3.1-2-p1/src/tw/fcoreport.h Hunk #1 succeeded at 84 with fuzz 3 (offset -1 lines). benz:~/tmp/tripwire-2.3.1-2 $ ls -l drwxr-xr-x 4 cbe credativ 4096 18. Nov 05:03 src/ drwxr-xr-x 3 cbe credativ 4096 2. Dez 12:23 tripwire-2.3.1-2-p1/ Note that it created a new tripwire-2.3.1-2-p1 directory inside the existing one, which is consistent with -p0. The newly created file contain just the “&#43;” lines from the patch. (There are no “-” lines.) patch 2.5.9 would have refused the patch because it couldn’t find the file to patch.
This is arguably a surprising behavior, but what really happens here is that -F3 (fuzz 3) will explicitly tell patch to ignore 3 context lines if it cannot apply the patch otherwise. diff’s default behavior is to create patches with 3 lines of context. patch’s default fuzz factor is one less than that, 2. Now, 3
3 is zero, which doesn’t leave any context left. Apparently lots of Gentoo ebuilds use -F3, and try to guess the correct number of directories to strip, starting with -p0, -p1, … No wonder that things break badly for them now, as patches will suddenly succeed with -p0.
I’m not sure I like the new patch behavior, but in Gentoo’s case I’d say they are using way too much magic in their build system, and now get bitten by options they shouldn’t have put there in the first place.">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/blog/index.html" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Myon&#39;s Blog
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Too much magic in Gentoo</h1>
      
      <p class="tracked"><strong>Christoph Berg</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2009-02-17T13:21:52+01:00">February 17, 2009</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Five years after the release of patch 2.5.9, patch 2.6 was released two weeks
ago. The most interesting feature is that it will now produce reject files in
unified format when the input is in that format. Lucky for those of us whose
brain hurts when trying to read context diffs.</p>
<p>Of course there are more changes, and one of them is affecting Gentoo in particular:
<a href="http://blog.flameeyes.eu/2009/12/01/gentoo-service-announcement-keep-clear-of-gnu-patch-2-6">
Gentoo service announcement: keep clear of GNU patch-2.6</a>. The linked
<a href="http://bugs.gentoo.org/show_bug.cgi?id=293570">Gentoo bug #293570</a>
has attachments to reproduce the bug:</p>
<pre>
benz:~/tmp/tripwire-2.3.1-2 $ patch -p0 -F3 < ../tripwire-friend-classes.patch
patching file tripwire-2.3.1-2-p1/src/fco/fconame.h
Hunk #1 succeeded at 48 with fuzz 3 (offset -1 lines).
patching file tripwire-2.3.1-2-p1/src/fco/fcosetimpl.h
Hunk #1 succeeded at 45 with fuzz 3 (offset -1 lines).
patching file tripwire-2.3.1-2-p1/src/tw/fcoreport.h
Hunk #1 succeeded at 84 with fuzz 3 (offset -1 lines).

benz:~/tmp/tripwire-2.3.1-2 $ ls -l
drwxr-xr-x 4 cbe credativ 4096 18. Nov 05:03 src/
drwxr-xr-x 3 cbe credativ 4096  2. Dez 12:23 tripwire-2.3.1-2-p1/
</pre>
<p>Note that it created a new tripwire-2.3.1-2-p1 directory inside the existing
one, which is consistent with -p0. The newly created file contain just the &ldquo;+&rdquo;
lines from the patch. (There are no &ldquo;-&rdquo; lines.) patch 2.5.9 would have refused
the patch because it couldn&rsquo;t find the file to patch.</p>
<p>This is arguably a surprising behavior, but what really happens here is that
-F3 (fuzz 3) will explicitly tell patch to ignore 3 context lines if it cannot
apply the patch otherwise. diff&rsquo;s default behavior is to create patches with 3
lines of context. patch&rsquo;s default fuzz factor is one less than that, 2. Now, 3</p>
<ul>
<li>3 is zero, which doesn&rsquo;t leave <i>any</i> context left.</li>
</ul>
<p>Apparently lots of Gentoo ebuilds use -F3, and try to guess the correct number
of directories to strip, starting with -p0, -p1, &hellip; No wonder that things
break badly for them now, as patches will suddenly succeed with -p0.</p>
<p>I&rsquo;m not sure I like the new patch behavior, but in Gentoo&rsquo;s case I&rsquo;d say they
are using way too much magic in their build system, and now get bitten by
options they shouldn&rsquo;t have put there in the first place.</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/blog/tags/debian.html" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Debian</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/posts/2009/Dedicating_Lenny_to_Thiemo.html">Dedicating Lenny to Thiemo</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2009/RFH_mutt.html">RFH: mutt</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2009/Useless_statistics.html">Useless statistics</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Arrogant_database.html">Arrogant database</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Cruftiness.html">Cruftiness</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Dear_irssi.html">Dear irssi</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Kernelspotting.html">Kernelspotting</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Mouseover_titles.html">Mouseover titles</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/New_toy.html">New toy</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Packages_up_for_adoption.html">Packages up for adoption</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Perl_is_strange.html">Perl is strange</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/RFC_wanted.html">RFC wanted</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Tenace.html">Tenace</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Time_between_releases.html">Time between releases</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/posts/2008/Time_machine.html">Time machine</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://df7cb.de/blog/index.html" >
    &copy;  Myon's Blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
